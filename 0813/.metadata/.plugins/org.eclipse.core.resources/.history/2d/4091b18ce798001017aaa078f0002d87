<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ page import="DB.DBConnect" %>
<%@ page import="java.sql.*" %>

<%
String sql="SELECT c.custno, c.custname, CASE c.grade WHEN 'A' THEN 'VIP' WHEN 'B' THEN '일반' ELSE '직원' END AS grade, SUM(m.price) AS price FROM member_tbl_02 c JOIN money_tbl_02 m ON c.custno = m.custno and m.price is not null GROUP BY c.custno, c.custname, c.grade ORDER BY price desc";
Connection conn = DBConnect.getConnection();
PreparedStatement pstmt = conn.prepareStatement(sql);
ResultSet rs = pstmt.executeQuery();
%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="css\style.css">
</head>
<body>
<header><jsp:include page="Layout\header.jsp"></jsp:include></header>
<nav><jsp:include page="Layout\nav.jsp"></jsp:include></nav>


<section class="section">
<h2>매출 정리</h2>
<table class=table_line>
<tr>
<th>custno</th>
<th>custname</th>
<th>grade</th>
<th>price</th>
</tr>
<%int i = 0;
while(rs.next()){
%>
<tr>
<th><%= rs.getString("custno") %></th>
<td><%= rs.getString("custname") %></td>
<td><%= rs.getString("grade") %></td>
<td><%= rs.getString("price") %></td>
</tr>


<%
i += rs.getInt("price");
} %>
<tr class="center">
<td colspan ="3">총합</td>
</tr>
</table>


</section>


<footer><jsp:include page="Layout\footer.jsp"></jsp:include></footer>
</body>
</html>