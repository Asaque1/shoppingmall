<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@page import="DB.DBConnect"%>
<%@page import="java.sql.*"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>회원목록 조회/수정</title>

<link rel="stylesheet" href="css\style.css">
<%
String sql = "SELECT c.custno, c.custname, CASE c.grade WHEN 'A' THEN 'VIP' WHEN 'B' THEN '일반' ELSE '직원' END AS grade, SUM(m.price) AS price FROM member_tbl_02 c JOIN money_tbl_02 m ON c.custno = m.custno GROUP BY c.custno, c.custname, c.grade ORDER BY c.custno desc;";
Connection conn = DBConnect.getConnection();
PreparedStatement pstmt = conn.prepareStatement(sql);
ResultSet rs = pstmt.executeQuery();

%>
</head>
<body>
<header>
<jsp:include page="Layout\header.jsp"></jsp:include>
</header>
<nav>
<jsp:include page="Layout\nav.jsp"></jsp:include>
</nav>
<section class=section>
<h2>회원매출 조회</h2>
<table class=table_line>
<tr>
<th>custno</th>
<th>custname</th>
<th>grade</th>
<th>maechul</th>
</tr>
<%
while(rs.next()){
%>
<tr class=center>
<td><%= rs.getInt("custno") %></td>
<td><%= rs.getString("custname") %></td>
<!-- 쿼리의 자리 순서나 자리 이름 상관 없음, 후자가 더 오류 적긴 함 -->
<td><%= rs.getString("phone") %></td>
<td><%= rs.getString("address") %></td>
<td><%= rs.getString("newdate") %></td>
<td><%= rs.getString("newgrade") %></td>
<td><%= rs.getString("city") %></td>
</tr>
<%
}
%>
</table>
</section>
<footer>
<jsp:include page="Layout\footer.jsp"></jsp:include>
</footer>

</body>
</html>